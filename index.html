<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Iowa Technical Assessment</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div class="container">
            <h1>Submit a receipt</h1>
                <form id="receiptForm" enctype="multipart/form-data">
                    <label for="date">Date of Purchase</label>
                    <input type="date" id="date" name="date" required>

                    <label for="amount">Amount</label>
                    <input type="number" id="amount" name="amount" step="0.01" min="0" required>
            
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="4" required></textarea>

                    <label for="receipt">Upload Receipt</label>
                    <input type="file" id="receipt" name="ReceiptFile" accept=".png,.jpg,.jpeg,.pdf" required>

                    <button type="submit">Submit</button>
                </form>
            <div id="status"></div>
        </div>
        <script>
            document.getElementById('receiptForm').addEventListener('submit', async (event) => {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form); // Automatically collects all form inputs

    try {
        const response = await fetch('http://localhost:5105/api/receipts/submit', {
            method: 'POST',
            body: formData // Send as multipart/form-data
        });

        const resultText = await response.text();

        if (response.ok) {
            document.getElementById('status').textContent = 'Receipt submitted successfully!';
            form.reset();
        } else {
            document.getElementById('status').textContent = `Error: ${resultText}`;
        }
    } catch (err) {
        document.getElementById('status').textContent = `Request failed: ${err}`;
    }
});
            /*
            document.getElementById('receiptForm').addEventListener('submit', async (event) => {
                event.preventDefault();

                const form = event.target;
                const date = form.date.value;
                const amount = parseFloat(form.amount.value);
                const description = form.description.value;
                const file = form.file.files[0];

                const payload = {
                    date: date,
                    amount: amount,
                    description: description,
                    filePath: file ? file.name : null
                };

                try {
                    const response = await fetch('http://localhost:5105/api/receipts', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok){
                        document.getElementById('status').textContent = 'Receipt submitted successfully!';
                        form.reset();
                    } else {
                        const error = await response.text();
                        document.getElementById('status').textContent = `Error: ${error}`;
                    }
                } catch(err){
                    document.getElementById('status').textContent = `Request failed: ${err}`;
                }
            });*/
        </script>
    </body>
</html>